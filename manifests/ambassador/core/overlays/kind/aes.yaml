---
apiVersion: getambassador.io/v3alpha1
kind: Listener
metadata:
  name: http-listener
spec:
  hostBinding:
    namespace:
      from: ALL
  port: 80
  protocol: HTTP
  securityModel: XFP
---
apiVersion: getambassador.io/v3alpha1
kind: Listener
metadata:
  name: https-listener
spec:
  hostBinding:
    namespace:
      from: ALL
  port: 443
  protocol: HTTPS
  securityModel: XFP
---
apiVersion: getambassador.io/v3alpha1
kind: Host
metadata:
  name: argocd
spec:
  hostname: edge.infra.lan
  requestPolicy:
    insecure:
      action: Route
  acmeProvider:
    authority: none
  tlsSecret:
    name: default-cert
---
apiVersion: getambassador.io/v2
kind: Mapping
metadata:
  name: argocd-server-ui
spec:
  host: edge.infra.lan
  prefix: /argo-cd
  rewrite: /argo-cd
  service: http://argocd-server.argocd:80
  docs:
    display_name: argocd
    path: /argo-cd
    url: http://argocd-server.argocd:80/argo-cd/swagger.json
    timeout_ms: 100000
    ignored: false  
---
apiVersion: getambassador.io/v2
kind: Mapping
metadata:
  name: argocd-server-cli
spec:
  host: edge.infra.lan
  prefix: /argo-cd
  rewrite: /argo-cd
  service: http://argocd-server.argocd:80
  regex_headers:
    Content-Type: "^application/grpc.*$"
  grpc: true