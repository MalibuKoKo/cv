apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
generators:
- ../../base/helm-chart.yaml
# resources:
# - aes.yaml
patches:
# - patch: |-
#     - op: replace
#       path: /spec/ports
#       value:
#         - appProtocol: http
#           name: http
#           port: 80
#           protocol: TCP
#           targetPort: http
#         - appProtocol: https
#           name: https
#           port: 443
#           protocol: TCP
#           targetPort: https
#   target:
#     kind: Service
#     name: edge-stack
- patch: |-
    - op: replace
      path: /rules
      value:
        - apiGroups:	
            - ''	
          resources:	
            - secrets	
          verbs:	
            - get	
            - list	
            - watch	
            - create	
            - update	
        - apiGroups:	
            - ''	
          resources:	
            - events	
          verbs:	
            - get	
            - list	
            - watch	
            - create	
            - patch	
        - apiGroups:	
            - coordination.k8s.io	
          resources:	
            - leases	
          verbs:	
            - get	
            - create	
            - update	
        - apiGroups:	
            - ''	
          resources:	
            - endpoints	
          verbs:	
            - get	
            - list	
            - watch	
            - create	
            - update	
        - apiGroups:	
            - apiextensions.k8s.io	
          resources:	
            - customresourcedefinitions	
          verbs:	
            - get	
            - list	
            - watch	
            - delete	
        - apiGroups:	
            - ''	
          resources:	
            - namespaces	
            - services	
            - secrets	
            - configmaps	
            - endpoints	
          verbs:	
            - get	
            - list	
            - watch	
        - apiGroups:	
            - getambassador.io	
            - gateway.getambassador.io	
          resources:	
            - '*'	
          verbs:	
            - get	
            - list	
            - watch	
            - update	
            - patch	
            - create	
            - delete	
        - apiGroups:	
            - getambassador.io	
          resources:	
            - mappings/status	
          verbs:	
            - update	
        - apiGroups:	
            - networking.internal.knative.dev	
          resources:	
            - clusteringresses	
            - ingresses	
          verbs:	
            - get	
            - list	
            - watch	
        - apiGroups:	
            - networking.x-k8s.io	
          resources:	
            - '*'	
          verbs:	
            - get	
            - list	
            - watch	
        - apiGroups:	
            - networking.internal.knative.dev	
          resources:	
            - ingresses/status	
            - clusteringresses/status	
          verbs:	
            - update	
        - apiGroups:	
            - extensions	
            - networking.k8s.io	
          resources:	
            - ingresses	
            - ingressclasses	
          verbs:	
            - get	
            - list	
            - watch	
        - apiGroups:	
            - extensions	
            - networking.k8s.io	
          resources:	
            - ingresses/status	
          verbs:	
            - update
  target:
    kind: ClusterRole
    name: edge-stack
- patch: |-
    - op: replace
      path: /rules
      value:
        - apiGroups:
            - argoproj.io
          resources:
            - applications
          verbs:
            - get
            - list
            - watch
        - apiGroups:
            - ''
          resources:
            - configmaps
          verbs:
            - get
            - list
            - watch
        - apiGroups:
            - apps
            - extensions
          resources:
            - deployments
          verbs:
            - get
            - list
            - watch
        - apiGroups:
            - ''
          resources:
            - endpoints
          verbs:
            - get
            - list
            - watch
        - apiGroups:
            - ''
          resources:
            - pods
          verbs:
            - get
            - list
            - watch
        - apiGroups:
            - argoproj.io
          resources:
            - rollouts
            - rollouts/status
          verbs:
            - get
            - list
            - watch
            - patch
  target:
    kind: ClusterRole
    name: edge-stack-agent