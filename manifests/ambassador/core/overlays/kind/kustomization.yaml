apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
generators:
- ../../base/helm-chart.yaml
patches:
- patch: |-
    - op: add
      path: /rules/0
      value:
        apiGroups:
          - apiextensions.k8s.io
        resources:
          - customresourcedefinitions
        verbs:
          - get
          - list
          - watch
          - delete
  target:
    kind: ClusterRole
    name: aes
# https://github.com/emissary-ingress/emissary/issues/5243#issuecomment-1735082630
- patch: |-
    - op: replace
      path: /rules
      value:
        - apiGroups:	
            - ''	
          resources:	
            - secrets	
          verbs:	
            - get	
            - list	
            - watch	
            - create	
            - update	
        - apiGroups:	
            - ''	
          resources:	
            - events	
          verbs:	
            - get	
            - list	
            - watch	
            - create	
            - patch	
        - apiGroups:	
            - coordination.k8s.io	
          resources:	
            - leases	
          verbs:	
            - get	
            - create	
            - update	
        - apiGroups:	
            - ''	
          resources:	
            - endpoints	
          verbs:	
            - get	
            - list	
            - watch	
            - create	
            - update	
        - apiGroups:	
            - apiextensions.k8s.io	
          resources:	
            - customresourcedefinitions	
          verbs:	
            - get	
            - list	
            - watch	
            - delete	
        - apiGroups:	
            - ''	
          resources:	
            - namespaces	
            - services	
            - secrets	
            - configmaps	
            - endpoints	
          verbs:	
            - get	
            - list	
            - watch	
        - apiGroups:	
            - getambassador.io	
            - gateway.getambassador.io	
          resources:	
            - '*'	
          verbs:	
            - get	
            - list	
            - watch	
            - update	
            - patch	
            - create	
            - delete	
        - apiGroups:	
            - getambassador.io	
          resources:	
            - mappings/status	
          verbs:	
            - update	
        - apiGroups:	
            - networking.internal.knative.dev	
          resources:	
            - clusteringresses	
            - ingresses	
          verbs:	
            - get	
            - list	
            - watch	
        - apiGroups:	
            - networking.x-k8s.io	
          resources:	
            - '*'	
          verbs:	
            - get	
            - list	
            - watch	
        - apiGroups:	
            - networking.internal.knative.dev	
          resources:	
            - ingresses/status	
            - clusteringresses/status	
          verbs:	
            - update	
        - apiGroups:	
            - extensions	
            - networking.k8s.io	
          resources:	
            - ingresses	
            - ingressclasses	
          verbs:	
            - get	
            - list	
            - watch	
        - apiGroups:	
            - extensions	
            - networking.k8s.io	
          resources:	
            - ingresses/status	
          verbs:	
            - update
  target:
    kind: ClusterRole
    name: aes
